<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Clinapp</title>

  <link href="/style.css" rel="stylesheet" type="text/css" />
  <meta property="og:image" content="https://clinapp.vercel.app/static/icon/clinapp.png">
  <meta property="og:image:width" content="389px">
  <meta property="og:image:height" content="542px">
  <meta property="keywords" content="#">
  <meta name="description" content="Clinapp tu Software de Gestión Hospitalaría más Flexible del Mercado">

  <!-- Google / Search Engine Tags -->
  <meta itemprop="name" content="Clinapp">
  <meta itemprop="description" content="Clinapp tu Software de Gestión Hospitalaría más Flexible del Mercado">

  <!-- Icons and Manifest -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icon/clinapp.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/static/icon/clinapp.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="/static/icon/clinapp.png" />
  <link rel="icon" type="image/x-icon" href="" />
  <link rel="manifest" href="/static/icon/clinapp.png" />

  <!-- Bootstrap and FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <!-- Additional Stylesheets -->
  <link rel="stylesheet" href="/style.css" />
  <link href="/tabla-style.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="/DFH/styleBodyViews.css">
</head>

<header>
  <nav class="navbar" style="background-color: #6d7e89;">
    <div class="container-fluid">
      <a class="navbar-brand" href="/view/centro_de_salud/view_centro_de_salud/urgencia.html">
        <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#7CCDD2">
          <path d="m274-450 248 248-42 42-320-320 320-320 42 42-248 248h526v60H274Z" />
        </svg>
        <b style="color:white">Volver</b>
      </a>
      <a class="navbar-brand" href="/view/centro_de_salud/centro_medico.html">
        <img src="/static/icon/centro_medico.jpg" alt="icon_cs" width="100px" height="100px">
        <b style="color:white">Centro Médico</b>
      </a>
    </div>
  </nav>
</header>

<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="script.js"></script>

  <br>

  <section style="margin-left: 20px;">
    <div class="card-body" style="text-align: center;">
      <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#7CCDD2">
        <path d="m780-339-42-43 68-68H640v-59h165l-68-68 43-43 140 140.5L780-339ZM80-780v-60h480v60H80Zm190 510h100v-100h100v-100H370v-100H270v100H170v100h100v100ZM100-120q-24 0-42-18t-18-42v-480q0-24 18-42t42-18h440q24 0 42 18t18 42v480q0 24-18 42t-42 18H100Zm0-60h440v-480H100v480Zm220-240Z" />
      </svg>
      <br>
      <b style="color:#6d7e89" class="card-text">Urgencia</b>
      <br><br>
    </div>

    <section style="margin: 10px;">
      <form id="urgenciaForm" method="post">
        <label for="identityNumber">RUN:</label>
        <input type="text" id="identityNumber" name="identityNumber" placeholder="Ingrese su número de identidad">
        <br><br>
        <div class="button-container">
          <input class="btn-form" type="submit" value="Consultar Urgencia">
        </div>
      </form>
      <br>
      <p>Aqui debe ir una lista con los pacientes categorizados en la sección de urgente; para ser llamados por la enfermera para rellenar los siguientes campos: (cabe destacar que el último campo de esta sección actualiza el campo de la actualización). <b>Esta es la parte del CRUD que actualiza la base de datos</b></p>
      
      <div id="TContain">
        <label for="selectPrioridad">Prioridad de Consulta: Eliga prioridad</label>
        <select id="selectPrioridad">
          <option value="Todos">Todos</option>
          <option value="Atención Inmediata">Atención Inmediata</option>
          <option value="Urgente">Urgente</option>
          <option value="Importante">Importante</option>
          <option value="No Urgente">No Urgente</option>
        </select>
        <label id="consultamsg" style="display: none; color: red;">No se encontraron registros</label>
        <table id="contenedorTabla">
          <thead>
            <!-- Encabezados de columna de tu tabla -->
          </thead>
          <tbody>
            <!-- Filas de datos de tu tabla -->
          </tbody>
        </table>
      </div>

      <div class="pagination" id="pagination-container">
        <!-- Controles de paginación se generarán aquí -->
      </div>
      <br>
    </section>

    <br><br>
    <hr>
    <br>

    <div class="container">
      <div id="containerRU" class="form-container"></div>
      <hr><br>
      <div id="containerRAB" class="form-container"></div>
      
      <div class="button-container">
        <input class="btn-form" type="submit" value="Registrar Urgencia">
      </div>
    </div>
  </section>

  <br><br>
  <footer style="background-color: black;">
    <div style="margin: 0 20px; text-align: center;">
      <br>
      <img src="/static/icon/softhispan.jpg" width="100px" height="100px">
      <p><b style="color: white">© Copyright 2024 Desarrollado por Softhispan</b></p>
      <br>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" crossorigin="anonymous"></script>
  <script src="/DFH/js/DOMControls.js"></script>
  <script src="/DFH/js/AppSettingsViews.js"></script>
  <script src="/DFH/Client HTTP/HttpBaseClient.js"></script>
  <script src="/DFH/Client HTTP/ServicioClient.js"></script>
  
  <script>
    // JSON para el Formulario Modular
    const jsonData = AppSettingsViews.getConfigViewConsultas();

    // Generar los formularios al cargar la página
    document.addEventListener("DOMContentLoaded", function () {
        DOMControls.generateForm(jsonData, "RegistrarUrgencia", "containerRU", [
            "id",
            "name",
            "value",
            "placeholder",
            "type",
            "required"
        ]);

        DOMControls.generateForm(jsonData, "RegistrarAtenciónBox", "containerRAB", [
            "id",
            "name",
            "value",
            "placeholder",
            "type",
            "required"
        ]);
    });
    

    async function consultarUrgencia() {
        const runInput = document.getElementById('identityNumber');
        const runValue = runInput.value;

        if (!runValue) {
            alert('Por favor, ingrese un RUN válido.');
            return;
        }

        const url = 'https://api.devcicm.com/servicio/SoftHispan/apirest/search';

        const dataToSend = {
            "FORM": {
                "Registrar Urgencia": {
                    "run": runValue
                }
            }
        };
        const token = "123e4567-e89b-12d3-a456-426614174000"; // Reemplaza con tu token real
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` // Incluir el token en el encabezado Authorization
                },
                credentials: 'include',
                body: JSON.stringify(dataToSend)
            });

            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.status} ${response.statusText}`);
            }

            const responseData = await response.json();

            if (responseData.success) {
                let parsedFormData;
                try {
                    parsedFormData = JSON.parse(responseData.data);
                } catch (error) {
                    console.error('Error al parsear los datos:', error);
                    alert('El formato de los datos recibidos no es válido.');
                    return;
                }

                // Cargar los datos en el formulario
                DOMControls.setValuesComponentsDOM(parsedFormData);

            } else {
                alert(responseData.message || 'No se encontraron datos para el RUN proporcionado.');
            }
        } catch (error) {
            console.error('Error al realizar la solicitud:', error);
            alert('Ocurrió un error al realizar la solicitud.');
        }
    }

    // Manejo de envío del formulario
    document.querySelector('#urgenciaForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Previene la acción por defecto del formulario.
        consultarUrgencia(); // Llama a la función de procesamiento.
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/CodeFlask.js/1.4.1/codeflask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
