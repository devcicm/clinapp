<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Clinapp</title>
  <link href="/style.css" rel="stylesheet" type="text/css" />
  <meta property="og:image" content="https://clinapp.vercel.app/static/icon/clinapp.png">
  <meta property="og:image:width" content="389px">
  <meta property="og:image:height" content="542px">
  <meta property="keywords" content="#">
  <meta name="description"
    content="Clinapp tu Software de Gestión Hospitalaría más Flexible del Mercado">

  <!-- Google / Search Engine Tags -->
  <meta itemprop="name" content="Clinapp">
  <meta itemprop="description"
    content="Clinapp tu Software de Gestión Hospitalaría más Flexible del Mercado">

  <!-- Link -->
  <link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/static/icon/clinapp.png"
  />
  <link
  rel="icon"
  type="image/png"
  sizes="192x192"
  href="/static/icon/clinapp.png"
  />
  <link
  rel="icon"
  type="image/png"
  sizes="512x512"
  href="/static/icon/clinapp.png"
  />
  <link rel="icon" type="image/x-icon" href="" />
  <link rel="manifest" href="/static/icon/clinapp.png" />

  <!-- bootstraps -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link
  rel="stylesheet"
  href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
  integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm"
  crossorigin="anonymous"
  />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/style.css" />  
  <link href="/tabla-style.css" rel="stylesheet" type="text/css" />

</head>
  <header>
    <nav style="background-color: #6d7e89;" class="navbar">
      <div class="container-fluid">
        <a class="navbar-brand" href="/view/centro_de_salud/view_centro_de_salud/urgencia.html">
        <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#7CCDD2"><path d="m274-450 248 248-42 42-320-320 320-320 42 42-248 248h526v60H274Z"/></svg>
          <b style="color:white">Volver</b>
          </a>
        <a class="navbar-brand" href="/view/centro_de_salud/centro_medico.html">
          <img src="/static/icon/centro_medico.jpg" alt="icon_cs" width="100px" height="100px">
          <b style="color:white">Centro Médico</b>
        </a>
      </div>
    </nav>
  </header>
<body onload="LoadConfig()">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script src="script.js"></script>
    <br>

  <section style="margin-left: 20px;">
    <div style="text-align: center;" class="card-body">
      <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#7CCDD2"><path d="m780-339-42-43 68-68H640v-59h165l-68-68 43-43 140 140.5L780-339ZM80-780v-60h480v60H80Zm190 510h100v-100h100v-100H370v-100H270v100H170v100h100v100ZM100-120q-24 0-42-18t-18-42v-480q0-24 18-42t42-18h440q24 0 42 18t18 42v480q0 24-18 42t-42 18H100Zm0-60h440v-480H100v480Zm220-240Z"/></svg>
      <br>                      
      <b style="color:#6d7e89" class="card-text">Urgencia</b>
        <br>
        <br>
    </div>
    <section style="margin-left: 10px; margin-right: 10px;">
      <form id="urgenciaForm"  action="" method="post">
        <label for="identityNumber">RUN:</label>
        <input type="text" id="identityNumber" name="identityNumber" placeholder="Ingrese su número de identidad" onclick="consultarUrgencia()">
        <br>
        <br>
         <div class="button-container">
          <input class="btn-form" type="submit" value="Consultar Urgencia">
        </div>
      </form>
      <br>
        <p>Aqui debe ir una lista con los pacientes categorizados en la sección de urgente; para ser llamados por la enfermera para rellenar los siguientes campos: (cabe destacar que el último campo de esta sección actualiza el campo de la actualización). <b>Esta es la parte del CRUD que actualiza la base de datos</b></p>
        <div id="TContain">
          <label for="selectPrioridad">Prioridad de Consulta: Eliga prioridad</label>
  <select id="selectPrioridad">
    <option value="Todos">Todos</option>
    <option value="Atención Inmediata">Atención Inmediata</option>
    <option value="Urgente">Urgente</option>
    <option value="Importante">Importante</option>
    <option value="No Urgente">No Urgente</option>
  </select>
  <label id="consultamsg" style="display: none; color: red;">No se encontraron registros</label>
          <table id="contenedorTabla">
              <thead>
                  <!-- Encabezados de columna de tu tabla -->
              </thead>
              <tbody>
                  <!-- Filas de datos de tu tabla -->
              </tbody>
          </table>
      </div>
      <div class="pagination" id="pagination-container">
          <!-- Controles de paginación se generarán aquí -->
      </div>
      <br>
      </section>
    <br>
    <br>
    <hr>
    <br>
    <div class="container">
      <br>
      <h1 style="color:#7CCDD2;">Registrar Atención Primaria</h1>
      <br>
        <label for="presion">Presión Arterial:</label>
        <input type="text" name="presion">
        <label for="temperatura">Temperatura:</label>
        <input type="text" name="temperatura">
        <label for="peso">Peso:</label>
        <input type="text" name="peso">
        <label for="estatura">Estatura:</label>
        <input type="text" name="estatura" id="estatura">
        <br>
        <br>
        <div style="width: calc(100% - 20px); box-sizing: border-box;">
          <label for="textInput">Ingrese Detalle de consulta:</label>
          <textarea style="width: 100%; height: 100%; box-sizing: border-box;" id="textInput" name="textInput" placeholder="..."></textarea>
        </div>
        <br>
        <hr>
        <br>
        <h1 style="color:#7CCDD2;">Registrar Atención Box</h1>
        <br>
          <label for="box">N° Box:</label>
          <input type="text" name="box">
          <label for="medico">Nombre Médico:</label>
          <input type="text" name="medico">
          <br>
          <br>
          <div style="width: calc(100% - 20px); box-sizing: border-box;">
            <label for="textInput">Detalle de Atención:</label>
            <textarea style="width: 100%; height: 100%; box-sizing: border-box;" id="textInput" name="textInput" placeholder="..."></textarea>
          </div>
          <br>
          <br>
          <div style="width: calc(100% - 20px); box-sizing: border-box;">
            <label for="laboratorio">Laboratorio:</label>
            <br>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="laboratorio0" name="laboratorio" value="No">
              <label class="form-check-label" for="laboratorio0">No</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="laboratorio1" name="laboratorio" value="Exámen 1">
              <label class="form-check-label" for="laboratorio1">Exámen 1</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="laboratorio2" name="laboratorio" value="Exámen 2">
              <label class="form-check-label" for="laboratorio2">Exámen 2</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="laboratorio3" name="laboratorio" value="Exámen 3">
              <label class="form-check-label" for="laboratorio3">Exámen 3</label>
            </div>
          <br>
          <br>
          <div style="width: calc(100% - 20px); box-sizing: border-box;">
            <label for="examen">Exámen:</label>
            <br>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="examen0" name="examen" value="No">
              <label class="form-check-label" for="examen0">No</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="examen1" name="examen" value="Exámen 1">
              <label class="form-check-label" for="examen1">Exámen 1</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="examen2" name="examen" value="Exámen 2">
              <label class="form-check-label" for="examen2">Exámen 2</label>
            </div>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="examen3" name="examen" value="Exámen 3">
              <label class="form-check-label" for="examen3">Exámen 3</label>
            </div>
          </div>
          <br>
          <br>
          <div style="width: calc(100% - 20px); box-sizing: border-box;">
            <label for="farmacia">Farmacia:</label>
            <textarea style="width: 100%; height: 100%; box-sizing: border-box;" id="farmacia" name="farmacia" placeholder="..."></textarea>
          </div>
          <br>
          <br
          <div style="width: calc(100% - 20px); box-sizing: border-box;">
            <label for="licencia">Licencia:</label>
            <br>
            <br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="licencia" id="licencia1" value="Si">
              <label class="form-check-label" for="licencia1">Si</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="licencia" id="licencia2" value="No">
              <label class="form-check-label" for="licencia2">No</label>
            </div>
          </div>
          <br>
          <br>
          <div class="row">
            <div class="col-sm-6 mb-3 mb-sm-0">
              <select class="form-select" aria-label="Default select example" id="destino" name="destino">
                <option selected>Destino:</option>
                <option value="Alta Médica">Alta Médica</option>
                <option value="Hospitalización">Hospitalización</option>
                <option value="Cirugía">Cirugía</option>
              </select>
            </div>
            <div class="col-sm-6">
              <label for="fecha_salida">Fecha de Salida de Urgencia:</label>
              <input type="datetime-local" name="fecha_salida" id="fecha_salida">
            </div>
          </div>
          <br>
          <br>
          <div class="button-container">
            <input class="btn-form" type="submit" value="Registrar Urgencia">
          </div>
        </form>
      </div>
      </section>
    <br>
    <br>
    <footer style="background-color: black;">
        <div style="margin-left: 20px; margin-right: 20px; text-align: center;">
            <br>
            <img src="/static/icon/softhispan.jpg" width="100px" height="100px">
            <p><b style="color: white">© Copyright 2024 Desarrollado por Softhispan</b></p>
            <br>
        </div>

    </footer>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
     <!-- Enlace a Bootstrap JS y dependencias -->
  <script src="/data/DbLocalStore.js"></script>
  <script>
    let DbLocalStoreInstance = null;
    let registros = null;
    const registrosPorPagina = 6;
            let paginaActual = 1;
    function LoadConfig() {
      DbLocalStoreInstance = DbLocalStore.getInstance("dbLocalStore");

      // Asignar el evento submit al formulario
      document.getElementById('urgenciaForm').addEventListener('submit', consultarUrgencia);
    }

    function consultarUrgencia(event) {
      // Evita el envío del formulario para ejecutar lógica adicional
      event.preventDefault();

      // Obtener el valor de identityNumber
      const identityNumberValue = document.querySelector('input[name="identityNumber"]').value.trim();

      // Verificar si el valor es nulo, vacío o solo contiene espacios
      if (!identityNumberValue) {
        alert('El campo "RUN" es obligatorio y no puede estar vacío.');
        return; // Detener la ejecución si la condición se cumple
      }

      // Muestra el valor en la consola
      console.log('El valor de identityNumber es:', identityNumberValue);

      // Llamar al método para obtener el registro
      const data = DbLocalStoreInstance.getRecordById(identityNumberValue);
      
      // Verifica si se encontró un registro
      if (!data) {
        alert('No se encontró un registro con ese RUN.');
        return; // Detener la ejecución si no se encontró el registro
      }

      console.log('Datos obtenidos:', data);

      // Reinsertar los datos en los campos del formulario
      for (const [key, value] of Object.entries(data)) {
        const element = document.querySelector(`[name="${key}"]`);
        if (element) {
          if (element.type === 'radio' || element.type === 'checkbox') {
            document.querySelector(`[name="${key}"][value="${value}"]`).checked = true;
          } else {
            element.value = value;
          }
        }
      }
     
    }

    document.getElementById('selectPrioridad').addEventListener('change', function () {
    const prioridadSeleccionada = this.value;

    // Obtiene los registros según la prioridad seleccionada
    if (prioridadSeleccionada !== 'Todos') {
        registros = DbLocalStoreInstance.getRecordsByPropertieId('flexRadioDefault', prioridadSeleccionada);
       
    } else {
        registros = DbLocalStoreInstance.getRecords();
    }

    // Muestra u oculta el mensaje de "No se encontraron registros"
    const consultaMsg = document.getElementById('consultamsg');
    if (registros.length === 0) {
        consultaMsg.style.display = 'block';
    } else {
        consultaMsg.style.display = 'none';
    }

    // Cargar los registros en la tabla con paginación
    cargarTablaConPaginacion(registros, registrosPorPagina, paginaActual);
    generarControlesPaginacion(registros.length, registrosPorPagina);
});


     

    ////////////////////////////////////////////


                     
            function cargarTablaConPaginacion(datosJSON, registrosPorPagina, pagina) {
                if (!Array.isArray(datosJSON)) {
                                     console.error("datosJSON no es un array:", datosJSON);
                            return;
                           }
                const startIndex = (pagina - 1) * registrosPorPagina;
                const endIndex = startIndex + registrosPorPagina;
                const datosPagina = datosJSON.slice(startIndex, endIndex);

                const tabla = crearTablaDesdeJSON(datosPagina,false);
                $("#contenedorTabla").empty().append(tabla);

                // Asignar evento a los botones de eliminar
                $(".btn-eliminar").off("click").on("click", function() {
                // Obtener la fila más cercana al botón de eliminar
                const fila = $(this).closest('tr');
    
                // Obtener el valor de la celda que contiene el identityNumber (se asume que es la primera celda de la fila)
                const idRegistro = fila.find('td').eq(0).text().trim();
    
                console.log("identityNumber a eliminar:", idRegistro);
    
                // Eliminar el registro de la base de datos local (localStorage)
                DbLocalStoreInstance .deleteRecord(idRegistro);

               // Luego, realizar cualquier otra acción necesaria, como eliminar la fila de la tabla
               eliminarRegistro(idRegistro);
               });

            }

            function generarControlesPaginacion(totalRegistros, registrosPorPagina) {
                const totalPaginas = Math.ceil(totalRegistros / registrosPorPagina);
                const paginationContainer = $('#pagination-container');
                paginationContainer.empty();

                for (let i = 1; i <= totalPaginas; i++) {
                    const pageLink = $('<a href="#" data-page="' + i + '">' + i + '</a>');
                    if (i === paginaActual) {
                        pageLink.addClass('active');
                    }
                    paginationContainer.append(pageLink);
                }

                $('#pagination-container a').on('click', function (event) {
                    event.preventDefault();
                    paginaActual = parseInt($(this).data('page'));
                    cargarTablaConPaginacion(registros, registrosPorPagina, paginaActual);
                    $('#pagination-container a').removeClass('active');
                    $(this).addClass('active');
                });
            }

            function eliminarRegistro(idRegistro) {
    const index = registros.findIndex(registro => registro.identityNumber == idRegistro);
    if (index !== -1) {
        registros.splice(index, 1);

        // Verificar si la página actual tiene registros después de eliminar
        const totalRegistros = registros.length;
        const totalPaginas = Math.ceil(totalRegistros / registrosPorPagina);

        // Si la página actual está vacía y no es la primera página, retroceder una página
        if (paginaActual > totalPaginas) {
            paginaActual = totalPaginas;
        }

        cargarTablaConPaginacion(registros, registrosPorPagina, paginaActual);
        generarControlesPaginacion(totalRegistros, registrosPorPagina);
    }
}


            $('#btnInsertar').on('click', function() {
                const nuevoRegistro = {
    "fecha_ingreso": "2024-08-31T23:03",
    "nombre": "Carlos Iván",
    "apellido": "asd",
    "identityNumber": "121",
    "textInput": "asd",
    "flexRadioDefault": "Urgente",
    "presion": "asd",
    "temperatura": "asd",
    "peso": "a",
    "estatura": "asd",
    "detalleConsultaPrimaria": "asd",
    "box": "asd",
    "medico": "asd",
    "detalleAtencion": "asd",
    "laboratorio": "Exámen 2",
    "examen": "Exámen 2",
    "farmacia": "asdasd",
    "licencia": "Si",
    "destino": "Alta Médica",
    "fecha_salida": "2024-08-31T22:04"
};

                registros.push(nuevoRegistro);
                DbLocalStoreInstance.addRecord(nuevoRegistro);
                cargarTablaConPaginacion(registros, registrosPorPagina, paginaActual);
                generarControlesPaginacion(registros.length, registrosPorPagina);
            });




        function crearTablaDesdeJSON(datosJSON, agregarAccion = true) {
            const tabla = $("<table></table>");
            const thead = $("<thead></thead>");
            const tbody = $("<tbody></tbody>");

            if (!datosJSON.length) {
                return tabla;
            }

            const ordenColumnas = Object.keys(datosJSON[0]);

            const encabezado = $("<tr></tr>");
            ordenColumnas.forEach((columna, indice) => {
                encabezado.append("<th>" + columna + "</th>");
            });

            if (agregarAccion) {
                agregarColumnaAccion(encabezado, tbody, datosJSON, ordenColumnas);
            } else {
                datosJSON.forEach(item => {
                    const fila = $("<tr></tr>");
                    ordenColumnas.forEach(columna => {
                        fila.append("<td>" + item[columna] + "</td>");
                    });
                    tbody.append(fila);
                });
            }

            thead.append(encabezado);
            tabla.append(thead).append(tbody);
            return tabla;
        }

        function agregarColumnaAccion(encabezado, tbody, datosJSON, ordenColumnas) {
            encabezado.append("<th>Acción</th>");

            datosJSON.forEach(item => {
                const fila = $("<tr></tr>");
                ordenColumnas.forEach(columna => {
                    fila.append("<td>" + item[columna] + "</td>");
                });
                agregarBotonEliminar(fila, item.identityNumber);
                tbody.append(fila);
            });
        }

        function agregarBotonEliminar(fila, idRegistro) {
            const botonEliminar = `<td><button class="btn btn-danger btn-eliminar" data-id="${idRegistro}">Eliminar</button></td>`;
            fila.append(botonEliminar);
        }






















  </script>
    

    <!-- Enlace a Bootstrap JS y dependencias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/CodeFlask.js/1.4.1/codeflask.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>